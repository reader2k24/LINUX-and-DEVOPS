# Проект "LINUX-and-DEVOPS"
## Примечание:
Данный проект приостановлен до 1 июня 2024 года.

## Описание
Проект "LINUX-and-DEVOPS" - это комплексная автоматизированная инфраструктура, разработанная для упрощения процесса развертывания веб-сайта. Он использует современные технологии и инструменты, обеспечивая надежность, масштабируемость и безопасность всей системы.

Цель проекта заключается в создании готового к использованию набора инструментов и конфигураций, которые могут быть легко адаптированы и расширены для различных потребностей веб-сайтов. Это позволяет сократить время развертывания и обслуживания веб-приложений, а также обеспечивает более эффективное использование ресурсов и снижение вероятности ошибок при настройке инфраструктуры.

## Использование
1. Склонируйте данный репозиторий на ваш управляющий хост:
   
    ```bash
    git clone https://github.com/reader2k24/LINUX-and-DEVOPS.git
    ```
2. Перейдите в склонированный репозиторий:
   
    ```bash
    cd LINUX-and-DEVOPS/
    ```
3. Обновите файл инвентаризации (<code>ansible/inventory/hosts.ini</code>).

## Ключевые компоненты
- Использование GitLab CI/CD для автоматизации процесса сборки, тестирования и развертывания приложения.
- Оркестрация контейнеров веб-приложения с помощью Kubernetes (K8S), обеспечивая масштабируемость и отказоустойчивость.
- Контейнеризация веб-приложения и сервера Nginx с помощью Docker, что облегчает управление и развертывание.
- Конфигурация и управление инфраструктурой Linux с использованием Ansible, что позволяет автоматизировать процесс настройки и обеспечить консистентность и безопасность всей системы.

## Настройка Linux

Для конфигурирования инфраструктуры Linux в рамках проекта "LINUX-and-DEVOPS" включает в себя следующие задачи:

- **Настройка IP адресов:** Назначение и конфигурация IP адресов для всех узлов в сети.

- **Настройка DHCP сервера:** Конфигурация DHCP сервера для автоматического назначения IP адресов клиентам в сети.

- **Настройка маршрутизации:** Конфигурация маршрутов для обеспечения связности между сетевыми сегментами.

- **Настройка VPN:** Создание и настройка виртуальной частной сети (VPN) для безопасного соединения удаленных сетей.

- **Настройка SSH:** Конфигурация SSH (Secure Shell) для безопасного удаленного доступа к серверам.

- **Настройка DNS:** Установка и настройка службы DNS для разрешения имен хостов в IP адреса.

- **Настройка NTP:** Конфигурация службы синхронизации времени (NTP) для обеспечения временной синхронизации в сети.

- **Настройка CUPS:** Установка и конфигурация сервера печати CUPS для обеспечения общего доступа к принтерам в сети.

- **Настройка NFS:** Установка и конфигурация NFS для обеспечения общего доступа к файловым ресурсам в сети.

- **Настройка ClamAV:** Установка и конфигурация антивирусной защиты с помощью ClamAV.

- **Настройка резервного копирования:** Разработка и настройка скриптов для создания резервных копий.

- **Настройка Firewalld и Iptables:** Конфигурация брандмауэра firewalld и Iptables для обеспечения безопасности сети и контроля трафика.

Эти задачи позволяют настроить и обеспечить работоспособность инфраструктуры Linux.

## Документация
Проект также включает в себя подробную документацию и руководства по использованию, что помогает пользователям быстро разобраться с настройкой и использованием системы.

Цель этого проекта - сделать процесс развертывания и управления веб-сайтом более эффективным, надежным и удобным для разработчиков и администраторов системы.


# Инструкция по настройки проекта "LINUX-and-DEVOPS"
## 1. Установка и настройка Ansible (локально)

Этот раздел содержит инструкции по установке и настройке Ansible на локальной системе, а также процесс подключения к удаленному серверу через SSH для управления им с помощью Ansible.

### 1.1. Установка Ansible

1. Обновите список пакетов:

    ```bash
    sudo apt update
    ```

2. Установите Ansible:

    ```bash
    sudo apt install ansible
    ```

### 1.2. Настройка удаленного сервера

1. Убедитесь, что на вашем удаленном сервере включена SSH аутентификация для root-пользователя. Для этого отредактируйте файл конфигурации SSH:

    ```bash
    sudo nano /etc/ssh/sshd_config
    ```

    Измените следующие параметры:

    ```
    Port 222*
    PermitRootLogin yes
    ```

2. Перезагрузите службу SSH:

    ```bash
    sudo systemctl restart ssh
    ```

### 1.3. Подключение к удаленному серверу

1. Получите IP-адрес вашего удаленного сервера:

    ```bash
    ip a
    ```

2. Скопируйте ваш открытый SSH ключ (id_rsa.pub) в файл authorized_keys на удаленном сервере:

    ```bash
    ssh-copy-id -i ~/.ssh/id_rsa.pub -p 222* root@IP_адрес
    ```

    Если файл id_rsa.pub отсутствует, создайте его с помощью команды:

    ```bash
    ssh-keygen
    ```

3. Введите пароль root-пользователя удаленного сервера, если это необходимо:

    ```bash
    sudo passwd root
    ```

# 2. Установка проекта "LINUX-and-DEVOPS" (GitLab)

Этот раздел содержит инструкции по установке проекта "LINUX-and-DEVOPS" с использованием GitLab.

## 2.1. Создание репозитория

1. Зайдите на GitLab и создайте новый проект.

2. Выберите опцию "Create blank project".

3. Укажите название проекта: "LINUX-and-DEVOPS".

4. Создайте пустой репозиторий без добавления README.md.

5. Скопируйте ссылку для клонирования репозитория в формате HTTPS.

## 2.2. Клонирование репозитория
1. Удалите текущую историю Git:

    ```bash
    rm -rf .git
    ```
2. Инициализируйте новый репозиторий Git:

    ```bash
    git init
    ```
3. Добавьте все файлы в индекс Git:

    ```bash
    git add .
    ```
4. Сделайте первый коммит:

    ```bash
    git commit -m "Новый проект"
    ```
5. Склонируйте репозиторий с GitLab:

    ```bash
    git clone https://gitlab.com/ci_cd*ID_CI_CD*/linux-and-devops.git .
    ```
6. Переключитесь на основную ветку (main):

    ```bash
    git switch --create main
    ```
7. Проверьте, что удаленный репозиторий правильно настроен:

    ```bash
    git remote -v
    ```
8. Если удаленный репозиторий не настроен, добавьте его:

    ```bash
    git remote add origin https://gitlab.com/*ID_CI_CD*/linux-and-devops.git
    ```
9. Отправьте изменения на удаленный репозиторий:

    ```bash
    git push --set-upstream origin main
    ```
10. Теперь ваш репозиторий склонирован и настроен для дальнейшей работы.

# 3. Установка и настройка CI/CD с помощью GitLab Runner

Этот раздел содержит инструкции по установке и настройке CI/CD с использованием GitLab Runner.

### 3.1 Загрузка и установка GitLab Runner

1. Загрузите двоичный файл GitLab Runner:

    ```bash
    sudo wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
    ```

2. Измените разрешения файла GitLab Runner на выполнение:

    ```bash
    sudo chmod +x /usr/local/bin/gitlab-runner
    ```

3. Создайте пользователя GitLab Runner:

    ```bash
    sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
    ```

4. Установите и запустите GitLab Runner в качестве службы:

    ```bash
    sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
    sudo gitlab-runner start
    ```

### 3.2. Настройка GitLab Runner
1. Создайте новый runner:

    ```bash
    sudo gitlab-runner register
    ```
2. Введите URL вашего экземпляра GitLab:

    ```bash
    https://gitlab.com/
    ```
3. Введите токен регистрации, который можно найти в настройках проекта GitLab:
   Settings -> CI/CD -> Runners -> Project runners -> Registration token (copy).
 
   ```bash
   
   ```
5. Введите описание для runner:

    ```bash
    new runners
    ```
6. Укажите теги для runner (через запятую):

    ```bash
    servers
    ```
7. Опционально введите заметку для обслуживания runner.

   ```bash
   
   ```
8. Выберите тип executor. В этом случае:

    ```bash
    ssh
    ```
9. Укажите адрес сервера SSH:

    ```bash
    IP VM
    ```
10. Укажите порт SSH сервера:

    ```bash
    PORT VM
    ```
11. Укажите пользователя SSH:

    ```bash
    root
    ```
12. Введите пароль пользователя SSH:

    ```bash
    PASSWD ROOT (VM)
    ```
13. Укажите путь к файлу идентификации SSH (если используется):

    ```bash
    /root/.ssh/id_rsa
    ```

### 3.3. Настройка SSH (VM)
1. Создайте файл known_hosts:

    ```bash
    touch /root/.ssh/known_hosts
    ```
2. Измените разрешения файла known_hosts:
    ```bash
    chmod 600 /root/.ssh/known_hosts
    ```

3. Добавьте свой собственный IP адрес в файл known_hosts:
    ```bash
    ssh-keyscan -H *IP >> ~/.ssh/known_hosts
    ```

### 3.4. Вход по SSH (local)
1. Войдите по SSH в собстенную учетную запись (root):

    ```bash
    ssh root@*IP -p 222*
    ```
2. Добавьте свой собственный id_rsa в файл authorized_keys, при отсутсвие файла id_rsa.pub применить команду `ssh-keygen:`
    ```bash
    ssh-copy-id -i /root/.ssh/id_rsa.pub -p 222* root@*IP
    ```
### 3.5. Проведение CI (GitLab)
Перейти в свой репозиторий GitLab и запустить Pipelines 
